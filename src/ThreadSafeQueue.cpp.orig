#include "ThreadSafeQueue.h"

ThreadSafeQueue::ThreadSafeQueue(void)
{
    lock = SDL_CreateMutex();
<<<<<<< HEAD
    available = SDL_CreateCond();
=======
>>>>>>> 39b907af4ea4367096692f4fcfce09dad1223db9
}

ThreadSafeQueue::~ThreadSafeQueue(void)
{
    SDL_LockMutex(lock);
    while(!workQueue.empty())
        workQueue.pop();
    SDL_UnlockMutex(lock);

    SDL_DestroyMutex(lock);
<<<<<<< HEAD
    SDL_DestroyCond(available);
=======
>>>>>>> 39b907af4ea4367096692f4fcfce09dad1223db9
}

//ThreadSafeQueue::ThreadSafeQueue(ThreadSafeQueue* q);

void ThreadSafeQueue::push(Updateable* job)
{
    SDL_LockMutex(lock);
    workQueue.push(job);
    SDL_CondSignal(available);
    SDL_UnlockMutex(lock);
}

Updateable* ThreadSafeQueue::pop(void)
{
    SDL_LockMutex(lock);
    while(workQueue.empty())
        SDL_CondWait(available,lock);
    Updateable* top = workQueue.front();
    workQueue.pop();
    SDL_UnlockMutex(lock);

    return top;
}